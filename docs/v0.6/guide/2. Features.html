<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>2. Features</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    <h1><a name="2. Features">2. Features</a></h1>Plugin features<h2><a name="2.1. Intercept Hibernate sessions">2.1. Intercept Hibernate sessions</a></h2>New Hibernate sessions will be published as events. There are various ways of subscribing to the events.<p class="paragraph"/><h3>From other plugins</h3><p class="paragraph"/>One way is to add an doWithEvents closure to the plugin description file (...GrailsPlugin.groovy). 
See Hawk Eventing's documentation for other ways of subscribing to events.<p class="paragraph"/><div class="code"><pre>def doWithEvents = &#123; ApplicationContext ctx &#45;&#62;<p class="paragraph"/>    hibernate.sessionCreated &#123; Event event &#45;&#62; 
        // Do something with the session (event.payload)
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><h3>Other options</h3><p class="paragraph"/>Have a look at the Hawk Eventing documentation for more information on how to subscribe to events. <h2><a name="2.2. Participating in post processing of Hibernate Configuration">2.2. Participating in post processing of Hibernate Configuration</a></h2>This is a very convenient way of doing things like adding Hibernate filters. 
No need to specify a Hibernate configClass and risk having another plugin replacing it.<p class="paragraph"/>The only thing needed to participate in the post processing of Hibernate's Configuration is to create a 
Spring bean implementing HibernateConfigPostProcessor. Your bean will be invoked when during construction of the SessionFactory.<p class="paragraph"/><div class="code"><pre>class MyConfigPostProcessor <span class="java&#45;keyword">implements</span> HibernateConfigPostProcessor &#123;<p class="paragraph"/>    @Override
    <span class="java&#45;keyword">public</span> void doPostProcessing(Configuration configuration) <span class="java&#45;keyword">throws</span> HibernateException &#123;
        // Do something with the configuration instance, like adding a <span class="java&#45;keyword">new</span> event listener.
        // Have a look at EventListenerConfigurator <span class="java&#45;keyword">for</span> an example.  
    &#125;<p class="paragraph"/>&#125;</pre></div><h2><a name="2.3. Register Hibernate event listeners">2.3. Register Hibernate event listeners</a></h2>Adding Hibernate event listeners can be a pain in the a<strong class="bold"></strong>. 
Feel free to look at the Hibernate API to get an idea of what you have to go through if you want to do this in a dynamic fashion.<p class="paragraph"/><h3>Convenient option using reflection</h3><p class="paragraph"/>A lot of Java programmers don't touch anything using the reflection API (which often is a good choice!), but I believe that there
are valid use cases for the reflection API and that this is one of them. By using reflection we're able to provide a much nicer API than Hibernate.
The most common argument made against the reflection API is the speed impact. This should not be too much of a concern in this case as this
is something that happens once during application startup / bootstrapping.<p class="paragraph"/>This option will detect all Hibernate <code>*EventListener</code> interfaces implemented by the instance and any super classes and add them
to the other event listeners.<p class="paragraph"/>Below is an example for this plugin.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugin.hibernatehijacker.hibernate.HibernateConfigPostProcessor<p class="paragraph"/>class EventListenerConfigurator <span class="java&#45;keyword">implements</span> HibernateConfigPostProcessor &#123;<p class="paragraph"/>    // This class <span class="java&#45;keyword">implements</span> most of Hibernates &#42;EventListener interfaces
    // in order to translate events into Hawk Events. 
    HibernateEventListener hibernateEventListener;<p class="paragraph"/>    @Override
    <span class="java&#45;keyword">public</span> void doPostProcessing(<span class="java&#45;keyword">final</span> Configuration configuration) <span class="java&#45;keyword">throws</span> HibernateException &#123;
        EventListeners eventListeners = configuration.getEventListeners();
        HibernateEventUtil.addListener(eventListeners, hibernateEventListener);
    &#125;<p class="paragraph"/>&#125;</pre></div><h2><a name="2.4. Listening to Hibernate Events">2.4. Listening to Hibernate Events</a></h2>I was a little unsure whether this was within the scope of this plugin or not. 
Grails 1.3.4 and JIRA 5725 made it a bit easier to add Hibernate event listeners, but this solution is a bit brittle and not very dynamic. 
If multiple plugins and/or applications declare this Spring bean they'll end up overwriting each other. So in the end I decided to implement this functionality.<p class="paragraph"/>It's implementation is very similar to the one found in FalconeUtil, but with a few exceptions. 
Sessions are not wrapped so there are no events for things like new criteria.<p class="paragraph"/>Have a look at the tests for examples.<h2><a name="2.5. Composite index DSL">2.5. Composite index DSL</a></h2>Support for defining multi column / composite indexes was added in 0.6. 
See <a href="http://jira.codehaus.org/browse/GRAILS-7301" target="blank">GRAILS-7301</a> for more information.<p class="paragraph"/><div class="code"><pre>class Person &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> firstname, surname
    <span class="java&#45;object">String</span> phone<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        // &#8230;
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> indexes = &#123;
        name_idx 'surname', 'firstname'
        phone_idx 'phone'
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/><blockquote class="note">
This is a very simple implementation and will probably not 
work if you've changed the table name in the mapping closure. 
</blockquote>
    </body>
</html>
